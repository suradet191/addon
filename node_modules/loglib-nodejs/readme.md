## How to use Log Library

### import module from loglib

#### for Express
~~~~ 
const {expressWarped, expressErrorWarped, LogSingleton, ACTION_TYPE} = require("loglib-nodejs");
~~~~ 


#### for NodeRed
~~~~ 
const {nodeRedWarped, LogSingleton, ACTION_TYPE} = require("loglib-nodejs");
~~~~ 

### setup config to loglib (require ENGINE_NAME in config or settings for NodeRed)

~~~~ 
LogSingleton.setup(config); #app.js or index.js for express , #settings.js for NodeRed
~~~~ 

### Example for Express

#### use expressWraped method for request (** log.send)
~~~~
app.get('/', expressWarped((req, res, next) => {
    log = LogSingleton.getLog(res);
    log.debug("testlog", {"aaa":"ccc"});
    log.activity(ACTION_TYPE.APPLICATION_ACTIVITY.CREATE, "sss", "test activity");
    headers = log.get_log_header;
    try{
        var xxx = sync_request('GET', 'http://localhost:5000/test2', {headers:headers});
        console.log(xxx.getBody())
        let result = {meta:{response_code:20000, response_desc:"Success"},data:{a:1}};
        res.send(result);
        log.send(result, res);
    }catch(e){
        next(e);
    }
}));
~~~~ 

#### use expressWraped method for request (** return by promise)
~~~~
app.get('/', expressWarped((req, res, next) => {
    log = LogSingleton.getLog(res);
    log.debug("testlog", {"aaa":"ccc"});
    log.activity(ACTION_TYPE.APPLICATION_ACTIVITY.CREATE, "sss", "test activity");
    headers = log.get_log_header;
    try{
        return axios.get('http://localhost:5000/test2', {headers:headers}).then((r)=>{
            return r;
        }).catch((e) => {
            return e;
        });
    }catch(e){
        next(e);
    }
}));
~~~~ 

#### and use expressErrorWarped method for error exception (** require log.send)
~~~~ 
app.use(expressErrorWarped((err, req, res, next) => {
    log = LogSingleton.getLog(res);
    log.exception(err.message);
    res.status(500).send("error");
    log.send("error", res);
}));
~~~~

### Example for NodeRed
~~~~
    node.on('input', nodeRedWarped(function(msg) {
        let log = LogSingleton.getLog(msg);
        log.debug("test inside");
        msg.payload = {response_code:20000, response_desc:"success", msg:"xxxx"};
        node.send(msg);
        log.send(msg);
    }));
~~~~ 

### Get log object by LogSingleton from args parameter

#### Express
~~~~
let log = LogSingleton.getLog(res); 
or 
let log = LogSingleton.getLog(); #for normal log to console and not support activity log
~~~~ 

#### NodeRed
~~~~
let log = LogSingleton.getLog(msg); 
or 
let log = LogSingleton.getLog(); #for normal log to console and not support activity log
~~~~ 

### write log message
~~~~
log.info('this info message')

log.debug('this debug message')

log.error('this error message')

log.exception('this error message with stack trace')

log.activity(ACTION_TYPE.APPLICATION_ACTIVITY.CREATE, "actioned object", "activity message"); #require action type and actioned object
~~~~

### get log header for request to other engine

~~~~
headers = log.get_log_header;
~~~~

### Ex. Configulation

~~~~
ex. response 
{
    'meta':{
        'response_code':20000,
        'response_desc':'Success'
    }
}

ex. config.json
{
    "ENGINE_NAME":"testloglib", //Engine Name required
    "RESPONSE_CODE_PATH":"meta/response_code", //path of response code default: meta/response_code
    "RESPONSE_DESC_PATH":"meta/response_desc"  //path of response describtion default: meta/response_desc"
    "IS_NODERED":false //default false
}
~~~~



